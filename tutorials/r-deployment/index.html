<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.54.0" />
    <meta name="description" content="">


    <title>R Deployment :: Clipper</title>
    <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
    <link href="/css/nucleus.css" rel="stylesheet">
    <link href="/css/font-awesome.min.css" rel="stylesheet">
    <link href="/css/hybrid.css" rel="stylesheet">
    <link href="/css/featherlight.min.css" rel="stylesheet">
    <link href="/css/horsey.css" rel="stylesheet">
    
    <link href="/css/theme.css" rel="stylesheet">
    
    
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <script src="/js/jquery-2.x.min.js"></script>
    <style type="text/css">
      :root #header + #content > #left > #rlblock_left {
        display:none !important;
      }
    </style>

    

    

  </head>
  <body class="" data-url="/tutorials/r-deployment/">
    <nav id="sidebar" class="">





<div class="highlightable">
  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="http://clipper.ai">
  <img id="grav-logo" src="/images/clipper-logo.png">
  </img>
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fa fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="Search...">
    <span data-search-clear=""><i class="fa fa-close"></i></span>
</div>
<script type="text/javascript" src="/js/lunr.min.js"></script>
<script type="text/javascript" src="/js/horsey.js"></script>
<script type="text/javascript">
    var baseurl = "http:\/\/clipper.ai\/";
</script>
<script type="text/javascript" src="/js/search.js"></script>

    
  </div>

  
    <ul class="topics">
        
            <li data-nav-id="/" class="dd-item">
            <a href="/"><i class="fa fa-fw fa-home"></i></a>
            </li>
        
        
        
          
          


 
  
    
    <li data-nav-id="/about/" class="dd-item 
        
        
        
        ">
      <a href="/about/">
        <span>About</span>

        
        

        
      </a>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/tutorials/" class="dd-item 
        parent
        
        
        ">
      <a href="/tutorials/">
        <span>User Guides</span>

        
        

          
            <i class="fa fa-angle-down fa-lg category-icon"></i>
          

        

        
      </a>
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/tutorials/basic_concepts/" class="dd-item
     
      ">
        <a href="/tutorials/basic_concepts/">
        <span>Basic Concepts</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/tutorials/xgboost_deployment/" class="dd-item
     
      ">
        <a href="/tutorials/xgboost_deployment/">
        <span>Example: XGBoost Deployment</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/tutorials/image_query/" class="dd-item
     
      ">
        <a href="/tutorials/image_query/">
        <span>Example: Querying Clipper with Images</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/tutorials/container_managers/" class="dd-item
     
      ">
        <a href="/tutorials/container_managers/">
        <span>Container Orchestration</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/tutorials/r-deployment/" class="dd-item
     active
      ">
        <a href="/tutorials/r-deployment/">
        <span>R Deployment</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/tutorials/metrics/" class="dd-item
     
      ">
        <a href="/tutorials/metrics/">
        <span>Monitoring Clipper Metrics</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/tutorials/rest/" class="dd-item
     
      ">
        <a href="/tutorials/rest/">
        <span>REST API Documentation</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/tutorials/custom_model_container/" class="dd-item
     
      ">
        <a href="/tutorials/custom_model_container/">
        <span>Creating a Custom Model Container</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/tutorials/troubleshooting/" class="dd-item
     
      ">
        <a href="/tutorials/troubleshooting/">
        <span>Troubleshooting</span> 
        
        </a></li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/support/" class="dd-item 
        
        
        
        ">
      <a href="/support/">
        <span>Support</span>

        
        

        
      </a>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/contributing/" class="dd-item 
        
        
        
        ">
      <a href="/contributing/">
        <span>Contributing</span>

        
        

        
      </a>
              
    </li>
  
 

          
        

        
        <section id="shortcuts">
            
                <li class="" role="">
                    <h3>More</h3>
                    <a href="http://docs.clipper.ai/en/v0.4.1/"><i class='fa fa-book'></i> API Docs</a>
                    
                </li>
            
                <li class="" role="">
                    
                    <a href="http://clipper.ai/api/api.html"><i class='fa fa-book'></i> REST API</a>
                    
                </li>
            
                <li class="" role="">
                    
                    <a href="https://github.com/ucbrise/clipper"><i class='fa fa-github'></i> Github repo</a>
                    
                </li>
            
        </section>    
        
        

        
    </ul>
    
     
    <section id="footer">
      <center>

<a class="github-button" href="https://github.com/ucbrise/clipper/archive/master.zip" data-icon="octicon-cloud-download" aria-label="Download ucbrise/clipper on GitHub">Download</a>


<a class="github-button" href="https://github.com/ucbrise/clipper" data-icon="octicon-star" data-show-count="false" aria-label="Star ucbrise/clipper on GitHub">Star</a>


<a class="github-button" href="https://github.com/ucbrise/clipper/fork" data-icon="octicon-repo-forked" data-show-count="false" aria-label="Fork ucbrise/clipper on GitHub">Fork</a>

</center>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
        
          <div id="top-bar">
            

            <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                <span id="sidebar-toggle-span">
                  <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                    <i class="fa fa-bars"></i>
                  </a>
                </span>
                <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
                <span class="links">
                







 <a href='/'>Clipper</a> > <a href='/tutorials/'>User Guides</a> > R Deployment

 

 

   
                </span>
            </div>
            <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#rclipper">Rclipper</a></li>
<li><a href="#dependencies">Dependencies</a></li>
<li><a href="#importing-rclipper">Importing Rclipper</a></li>
<li><a href="#writing-an-api-compatible-r-prediction-function">Writing an API-compatible R prediction function</a></li>
<li><a href="#building-a-model">Building a model</a></li>
<li><a href="#deploying-a-model">Deploying a model</a></li>
<li><a href="#querying-a-model">Querying a model</a></li>
<li><a href="#example">Example</a>
<ul>
<li><a href="#import-rclipper">Import Rclipper</a></li>
<li><a href="#define-an-api-compatible-prediction-function">Define an API-compatible prediction function</a></li>
<li><a href="#build-a-model">Build a model</a></li>
<li><a href="#deploy-and-link-the-model">Deploy and link the model</a></li>
<li><a href="#query-the-model">Query the model</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

          </div>
        
        
        <div id="body-inner">
          
            <h1>R Deployment</h1>
          






<h2 id="rclipper">Rclipper</h2>

<p><strong>R clipper is currently not maintained</strong></p>

<p>Rclipper is a package for building serveable Clipper models from R
functions. Given an API-compatible R function, Rclipper’s
<strong>build_model</strong> function builds a Docker image for a Clipper model.
This model can then be deployed to Clipper via the <a href="https://pypi.python.org/pypi/clipper_admin">Python
clipper_admin package</a>.</p>

<h2 id="dependencies">Dependencies</h2>

<p>Rclipper depends on the <a href="https://pypi.python.org/pypi/clipper_admin">Python clipper_admin
package</a> for building and
deploying models. In order to use this admin package, <a href="https://pypi.python.org/pypi/docker/">Docker for
Python</a> must also be installed.</p>

<h2 id="importing-rclipper">Importing Rclipper</h2>

<p><strong>It is very important that Rclipper be imported before a prediction
function or its dependencies are defined</strong>. Rclipper makes use of the
<a href="https://cran.r-project.org/web/packages/histry/index.html">histry
package</a> to
statically analyze dependency definitions. In order to locate these
definition expressions during function serialization, histry must be
imported before the expressions are executed.</p>

<h2 id="writing-an-api-compatible-r-prediction-function">Writing an API-compatible R prediction function</h2>

<p>An API-compatible prediction function must accept a type-homogeneous
<strong>list</strong> of inputs of one of the following types:</p>

<ul>
<li>Raw Vector</li>
<li>Integer Vector</li>
<li>Numeric Vector</li>
<li>String (length-1 character vector)</li>
<li>Data Frame</li>
<li>Matrix</li>
<li>Array</li>
<li>List</li>
</ul>

<p>Additionally, <strong>given a list of inputs</strong> of length <em>N</em>, a prediction
function <strong>must return a list of outputs</strong> of length <em>N</em>. All elements
of the output list must be of the same type.</p>

<p><strong>Note:</strong> If a prediction function returns a list of string (length-1
character vector) objects, each output will be returned as-is, without
any additional serialization. Otherwise, all non-string outputs will be
string-serialized via the <a href="https://cran.r-project.org/web/packages/jsonlite/index.html">jsonlite
package</a>,
and their serialized representations will be returned.</p>

<h2 id="building-a-model">Building a model</h2>

<p>Once you’ve written an API-compatible prediction function, you can build
a Clipper model with it via the <strong>build_model</strong> function:</p>

<pre><code>#' @param model_name character vector of length 1. The name to assign to the model image.
#' @param model_version character vector of length 1. The version tag to assign to the model image.
#' @param prediction_function function. This should accept a type-homogeneous list of 
#' inputs and return a list of outputs of the same length. If the elements of the output list
#' are not character vectors of length 1, they will be converted to a serialized
#' string representation via 'jsonlite'.
#' @param sample_input For a prediction function that accepts a list of inputs of type X,
#' this should be a single input of type X. This is used to validate the compatability
#' of the function with Clipper and to determine the Clipper data type (bytes, ints, strings, etc)
#' to associate with the model.
#' @param model_registry character vector of length 1. The name of the image registry
#' to which to upload the model image. If NULL, the image will not be uploaded to a registry.

Rclipper::build_model(model_name, model_version, prediction_function, sample_input, model_registry = NULL)
</code></pre>

<p>This will build a Docker image with the tag:
<em>model_registry</em>/<em>model_name</em>:<em>model_version</em>. If no registry was
specified, the image will have the tag: <em>model_name</em>:<em>model_version</em>.
Additonally, this function will output a command that you can execute
within an interactive Python environment to deploy the model with the
<a href="https://pypi.python.org/pypi/clipper_admin">clipper_admin package</a>.</p>

<h2 id="deploying-a-model">Deploying a model</h2>

<p>Once you’ve built a model, use the provided command to deploy it with
the <a href="https://pypi.python.org/pypi/clipper_admin">clipper_admin
package</a>. For information
about how to register the model with an application so that it can be
queried, please consult the <a href="http://docs.clipper.ai/en/">clipper_admin API
documentation</a>.</p>

<h2 id="querying-a-model">Querying a model</h2>

<p>After you’ve built a model, deployed the model, and registered the model
with an application, you can query it with input data of the correct
type. The following table maps the input type of your model’s prediction
function to the Clipper input type associated with your deployed model:</p>

<table>
<thead>
<tr class="header">
<th style="text-align: right;">R input type</th>
<th style="text-align: left;">Clipper Input Type</th>
<th style="text-align: center;">JSON Format</th>
<th style="text-align: center;">Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">Raw Vector</td>
<td style="text-align: left;">Bytes</td>
<td style="text-align: center;">Base64-encoded string</td>
<td style="text-align: center;">Y2xpcHBlciB0ZXh0</td>
</tr>
<tr class="even">
<td style="text-align: right;">Integer Vector</td>
<td style="text-align: left;">Ints</td>
<td style="text-align: center;">Integer array</td>
<td style="text-align: center;">[1,2,3,4]</td>
</tr>
<tr class="odd">
<td style="text-align: right;">Numeric Vector</td>
<td style="text-align: left;">Doubles</td>
<td style="text-align: center;">Floating point array</td>
<td style="text-align: center;">[1.0,2.0,3.0.,4.0]</td>
</tr>
<tr class="even">
<td style="text-align: right;">Character Vector</td>
<td style="text-align: left;">Strings</td>
<td style="text-align: center;">String</td>
<td style="text-align: center;">“input text”</td>
</tr>
<tr class="odd">
<td style="text-align: right;">Data Frame</td>
<td style="text-align: left;">Strings</td>
<td style="text-align: center;">String</td>
<td style="text-align: center;"><code>jsonlite::toJSON(mtcars)</code></td>
</tr>
<tr class="even">
<td style="text-align: right;">Matrix</td>
<td style="text-align: left;">Strings</td>
<td style="text-align: center;">String</td>
<td style="text-align: center;"><code>jsonlite::toJSON(diag(3))</code></td>
</tr>
<tr class="odd">
<td style="text-align: right;">Array</td>
<td style="text-align: left;">Strings</td>
<td style="text-align: center;">String</td>
<td style="text-align: center;"><code>jsonlite::toJSON(array(1:4))</code></td>
</tr>
<tr class="even">
<td style="text-align: right;">List</td>
<td style="text-align: left;">Strings</td>
<td style="text-align: center;">String</td>
<td style="text-align: center;"><code>jsonlite::toJSON(list(1:4))</code></td>
</tr>
</tbody>
</table>

<h2 id="example">Example</h2>

<h3 id="import-rclipper">Import Rclipper</h3>

<pre><code>library(Rclipper)

## Loading required package: CodeDepends

## Loading required package: histry
</code></pre>

<h3 id="define-an-api-compatible-prediction-function">Define an API-compatible prediction function</h3>

<pre><code>#' Given a list of vector inputs,
#' outputs a list containing the
#' length of each input vector as a string
pred_fn = function(inputs) {
return(lapply(inputs, function(input) {
return(as.character(length(input)))
}))
}

print(pred_fn(list(c(1,2), c(3))))

## [[1]]
## [1] &quot;2&quot;
## 
## [[2]]
## [1] &quot;1&quot;
</code></pre>

<h3 id="build-a-model">Build a model</h3>

<pre><code># Specify that the prediction function expects integer vectors
# by supplying an integer vector as the sample input
Rclipper::build_model(&quot;test-model&quot;, &quot;1&quot;, pred_fn, sample_input = as.integer(c(1,2,3)))

## [1] &quot;Serialized list of dependent libraries: Rclipper: knitr: histry: CodeDepends: stats: graphics: grDevices: utils: datasets: methods: base&quot;
## [1] &quot;Serialized model function!&quot;
## [1] &quot;Done!&quot;
## To deploy this model, execute the following command from a connected ClipperConnection object `conn`:
## conn.deploy_model(&quot;test-model&quot;, &quot;1&quot;, &quot;ints&quot;, &quot;test-model:1&quot;, num_replicas=&lt;num_container_replicas&gt;)
</code></pre>

<h3 id="deploy-and-link-the-model">Deploy and link the model</h3>

<p>This assumes that a Clipper cluster is running on <em>localhost</em> with a
registered application that has the name <em>app1</em>. In a Python interactive
environment:</p>

<pre><code>from clipper_admin import DockerContainerManager, ClipperConnection
cm = DockerContainerManager()
conn = ClipperConnection(cm)
conn.connect()

# Deploy a single replica of the model
conn.deploy_model(name=&quot;test-model&quot;, version=&quot;1&quot;, input_type=&quot;ints&quot;, image=&quot;test-model:1&quot;, replicas=1)

conn.link_model_to_app(app_name=&quot;app1&quot;, model_name=&quot;test-model&quot;)
</code></pre>

<h3 id="query-the-model">Query the model</h3>

<p>You can now query the model from any HTTP client. For example, directly
from the command line with <a href="https://github.com/curl/curl">cURL</a>:</p>

<pre><code>$ curl -X POST --header &quot;Content-Type:application/json&quot; -d '{&quot;input&quot;: [1,2,3,4]}' 127.0.0.1:1337/app1/predict

$ {&quot;query_id&quot;:2,&quot;output&quot;:4,&quot;default&quot;:false}
</code></pre>


<footer class=" footline" >
	
</footer>




        

      </div>
    </div>

    
 
    

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


        
            <a class="nav nav-prev" href="/tutorials/container_managers/" title="Container Orchestration"> <i class="fa fa-chevron-left"></i></a>
        
        
            <a class="nav nav-next" href="/tutorials/metrics/" title="Monitoring Clipper Metrics" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
        
    </div>

    </section>
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>    

    <script src="/js/clipboard.min.js"></script>
<script src="/js/featherlight.min.js"></script>
<script src="/js/html5shiv-printshiv.min.js"></script>
<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script src="/js/modernizr.custom.71422.js"></script>
<script src="/js/learn.js"></script>
<script src="/js/hugo-learn.js"></script>


<link href="/mermaid/mermaid.css" type="text/css" rel="stylesheet"/>
<script src="/mermaid/mermaid.js"></script>
<script>mermaid.initialize({startOnLoad:true});</script>
    

  </body>
</html>

